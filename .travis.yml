---
sudo: required
dist: bionic
notifications:
  slack:
    on_failure: always
matrix:
  fast_finish: true
  include:

    - name: "deploy trivy wo homebrew on macOS 10.15.4 osx xcode11.5"
      os: osx
      osx_image: xcode11.5
      language: shell
      addons:
        homebrew:
          packages:
          - curl
          update: true
      before_install:
        - pip install virtualenv
        - virtualenv -p $(which python2) ~venvpy2
        - source ~venvpy2/bin/activate
      script:
        - curl -sfL https://raw.githubusercontent.com/aquasecurity/trivy/master/contrib/install.sh | sh -s -- -b /usr/local/bin
        # failed to download vulnerability DB
        # - trivy image python:3.4-alpine
      after_success:
        - deactivate

    - name: "deploy trivy w homebrew tap on macOS 10.15.4 osx xcode11.5"
      os: osx
      osx_image: xcode11.5
      language: shell
      addons:
        homebrew:
          taps: aquasecurity/trivy/trivy
          packages:
            - trivy
          update: true
      before_install:
        - pip install virtualenv
        - virtualenv -p $(which python2) ~venvpy2
        - source ~venvpy2/bin/activate
      script:
        - brew install aquasecurity/trivy/trivy
        # failed to download vulnerability DB
        # - trivy image python:3.4-alpine
      after_success:
        - deactivate

    - name: "deploy trivy w homebrew on macOS 10.15.4 osx xcode11.5"
      os: osx
      osx_image: xcode11.5
      language: shell
      before_install:
        - pip install virtualenv
        - virtualenv -p $(which python2) ~venvpy2
        - source ~venvpy2/bin/activate
      script:
        - brew install aquasecurity/trivy/trivy
        # failed to download vulnerability DB
        # - trivy image python:3.4-alpine
      after_success:
        - deactivate